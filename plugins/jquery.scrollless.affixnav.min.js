/**
 * jquery.scrollless.affixnav
 * Contents navigation for jquery.scrollless
 * 
 * @version  0.9.0
 * @requires jquery.scrollless
 * @author   Savr Goryaev (savreen.com/contact/)
 * @license  GPL v2 http://opensource.org/licenses/GPL-2.0
 */

(function(e){function E(t){if(!this||!S(t)||!s||!this.find("."+s).length){T();return}u=true;if(!f){a=this;f=e(r).html(n);this.wrap(i).parent().after(f)}f.show()}function S(e){if(!e||typeof e!="object")return false;e.attachItemData=true;if(!("affixnav"in e))return true;if("disable"in e.affixnav)return false;if("classHeader"in e.affixnav)s=e.affixnav.classHeader;if("classHeaderLevel"in e.affixnav)o=e.affixnav.classHeaderLevel;return true}function x(n,r){if(!u||!f||!n||!n.length)return;var i="scrollless-item";l=n.length;d.length=v.length=0;v.length=l;var a=[];var y=this.find("."+s);var b=[];c=y.length;for(var w=0;w<c;w++){var E=y.eq(w),S;var x=E.hasClass(i)?E:(S=E.parents("."+i)).length||(S=E.find("."+i)).length?S.eq(0):0;if(!x)continue;for(var T=0;T<5&&!E.hasClass(o+(T+1));T++);var N=T<5?T:0;var C=x.data("iItem");if(v[C]==undefined)v[C]=d.length;d.push(C);b.push(N);a.push(E.text())}var k=e(t);var O=f.children().eq(1).empty();var M=f.height();var _=[];for(w=0;w<c;w++){var D=k.clone().html(a[w]).addClass(o+(b[w]+1)).data("iHeader",w).appendTo(O);_[w]=f.height()-M;D.hide()}g=M;m=_;h=O.children().on("click",L);if(p)return;p=f.find(".affixnav-arrow");p.children().each(function(t){e(this).data("arrowtype",t)}).on("click",A)}function T(){if(!u||!f)return;u=false;f.hide()}function N(e){if(!u||typeof e!="object")return;if(e.fixed){y=e.height}else{y=a.height();k()}}function C(e){if(!u||typeof e!="object")return;var t=e.start,n=e.end,r;if(v[t]!=undefined)b=v[t];else{for(r=t-1;r>=0&&v[r]==undefined;r--);b=r>=0?v[r]:0}if(v[n]!=undefined)w=v[n];else{for(r=n+1;r<l&&v[r]==undefined;r++);w=r<l?v[r]:c}k()}function k(){var e=y-g;var t=0,n,r;for(n=b;n<w&&t+m[n]<e;n++)t+=m[n];var i=true;for(n=w,r=b-1;i;){var s,o;if(s=n<l&&t+m[n]<e)t+=m[n++];if(o=r>=0&&t+m[r]<e)t+=m[r--];i=s||o}var u=r<b-1?r+1:b,a=n;h.removeClass("affixnav-cursor").slice(b,w).addClass("affixnav-cursor");h.hide().slice(u,a).show();O(0,u);O(1,a<c-1)}function L(t){t.preventDefault();var n=e(this).data("iHeader");var r=d[n];e.scrollless.setPos(r)}function A(t){t.preventDefault();var n=Number(e(this).data("arrowtype"));e.scrollless.setPos(n?d[c-1]:d[0])}function O(e,t){p.eq(e).css("visibility",t?"visible":"hidden")}e.scrollless.on("preInit",E).on("postInit",x).on("disable",T).on("changeSize",N).on("changePos",C);var t='<li class="affixnav-item"></li>';var n='<div class="affixnav-arrow"><span class="arrow-up"></span></div>'+"<ul></ul>"+'<div class="affixnav-arrow"><span class="arrow-down"></span></div>';var r='<td class="affixnav"></td>';var i='<table class="affixnav-wrap"><tr><td></td></tr></table>';var s="affixnav-header";var o="level";var u=false;var a=0;var f=0;var l=0;var c=0;var h=0;var p=0;var d=[];var v=[];var m=[];var g=0;var y=0;var b=0;var w=0})(jQuery)