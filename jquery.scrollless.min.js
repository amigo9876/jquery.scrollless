/**
 * jquery.scrollless
 * Total replacement of native scrolling
 * https://github.com/hindmost/jquery.scrollless
 * 
 * @version  0.9.0
 * @requires jQuery
 * @author   Savr Goryaev (savreen.com/contact/)
 * @license  GPL v2 http://opensource.org/licenses/GPL-2.0
 */

(function(e){function H(t){if(!d)return false;p=true;R();if(typeof t!="object")t={};for(var n in u)u[n].call(d,t);if(!B(t)||!d.children().length)return false;var i=e(document).height();Q();L=C;A=k;var s=k-i+d.height();T=r>0?Math.round(r<=1?s*r:Math.min(r,s)):s;v=e([]);g=e([]);try{F(d,0)}catch(f){return false}m=v.length;y=g.length;b.length=0;for(n=0;n<y;n++){b.push(g.eq(n).data("nestrange"));g.eq(n).removeData("nest")}G();if(o){v.addClass("scrollless-item");for(n=0;n<m;n++)v.eq(n).data("iItem",n)}nt(true);for(n in a)a[n].call(d,v,S.slice());if(o){v.removeClass("scrollless-item");for(n=0;n<m;n++)v.eq(n).removeData("iItem")}return true}function B(e){if(!e||typeof e!="object")return false;if("position"in e)t=Math.floor(Number(e.position));if("itemQuota"in e&&e.itemQuota>=.1)r=Number(e.itemQuota);if("itemNestDepth"in e)n=Math.floor(Number(e.itemNestDepth));if("autoRestore"in e)s=Boolean(e.autoRestore);if("attachItemData"in e)o=Boolean(e.attachItemData);if("timePostpone"in e&&e.timePostpone>=300)i=Math.floor(Number(e.timePostpone));return true}function j(e,t){if(typeof t=="function")e.push(t)}function F(t,r){if(r>n){throw 1;return}var i=t.children(),s=i.length,o=0;if(!s){throw 2;return}var u=["tbody","thead","tfoot"];for(var a=0;a<s;a++){var f=i.eq(a);var l=f.get(0).currentStyle||window.getComputedStyle(f.get(0),null);if(l.display=="inline"||l.display=="table-cell")break;var c=e.inArray(f.get(0).tagName.toLowerCase(),u)>=0;if(!c&&f.height()<T)continue;v=v.add(i.slice(o,a));o=a+1;var h=v.length;F(f,r+1);f.data("nestrange",[h,v.length]);g=g.add(f)}if(o<s)v=v.add(o?i.slice(o,s):i)}function I(){$();if(!p){if(s&&Q()&&C>=O&&k>=M)V();return}if(Q()){nt(false);z(true)}P=setTimeout(q,i)}function q(){$();if(!p)return;Q();if(Math.abs(C/L-1)>.1){G();v.slice(_,D).show();tt()}else if(C!=L){Y();Z()}if(C>L||k>A){W()}L=C;A=k;if(L*A<O*M){O=L;M=A}nt(true);st()}function R(){_=D=0}function U(e,t,n){e=typeof e=="number"?e:0;if(!(e>=0&&e<m)||D>=m&&e>_)return;var r=_,i=D;var s=k-N;var o=typeof t=="number"&&t>=0&&t<=e,u=typeof n=="number"&&n>0&&n<m;t=o?t:0;n=u?n:m;for(var a=0,f=e;f<n&&a+S[f]<s;f++)a+=S[f];D=f;_=e;if(u||D==m){for(f=_-1;f>=t&&a+S[f]<s;f--)a+=S[f];if(f<_-1)_=f+1}if(u&&_==t){for(f=D;f<m&&a+S[f]<s;f++)a+=S[f];if(f>D)D=f}if(_==D){X(true);return}if(_==r&&D==i)return;v.hide().slice(_,D).show();tt();if(!z())et();st()}function z(t){if(D-_<=1)return false;var n=e(document).height()-k;if(n<=0)return false;if(t)Y();for(var r=0,i=D-1;i>_&&(r+=S[i])<n;i--);if(i<=_){X(true);return false}v.slice(i,D).hide();D=i;tt();et();return true}function W(){if(D==m)return;for(var e=0,t=_;t<D;t++)e+=S[t];var n=e;var r=k-N-n;if(r<=0)return;for(e=0,t=D;t<m&&(e+=S[t])<r;t++);if(t==D)return;v.slice(D,t).show();D=t;tt();if(!z())et()}function X(e){if(!p)return;p=false;R();if(e){if(m)v.show();if(y)g.show()}if(!f.length)return;for(var t in f)f[t].call(null)}function V(){if(H())U(_);else X(false)}function $(){if(P)clearTimeout(P)}function Q(){J=C;K=k;C=e(window).width();k=e(window).height();if(C==J&&k==K)return false;return true}function G(){var t=e(document).height(),n=d.height();var r=d.get(0).style;r.overflow="hidden";r.visibility="hidden";r.height=T;r.width=d.width();v.show();var i=e(document).height(),s=d.height();N=i-s;S.length=w.length=E.length=x.length=0;var o=[];var u=d.height();for(var a=0,f=m-1;f>=0;f--){var l=v.eq(f).height();v.eq(f).hide();var c=d.height();a+=o[f]=Math.max(u-c,0);E[f]=Math.max(o[f]-l,0);x[f]=0;u=c}if(y)g.hide();r.height=r.width="auto";r.overflow="visible";r.visibility="visible";w=o.slice();S=o.slice();var h=Math.max(s-a,0)}function Y(){for(var e=0,t=_;t<D;t++){e+=S[t]=v.eq(t).height()+E[t]}}function Z(){for(var e=0,t=_;t<D;t++){e+=S[t]/w[t]}var n=e/(D-_);var r=n>1;for(t=0;t<m;t++){if(t>=_&&t<D||x[t])continue;S[t]=r?Math.round(w[t]*n):w[t]}}function et(){for(var e=_;e<D;e++){x[e]=1}}function tt(){var e=[];for(var t=0;t<y;t++){var n=b[t],r=n[0],i=n[1];(e[t]=r<D&&_<i)?g.eq(t).show():g.eq(t).hide()}}function nt(e){if(!l.length)return;var t={fixed:e,height:k-N};for(var n in l)l[n].call(null,t)}function st(){if(!c.length)return;if(_==rt&&D==it)return;rt=_;it=D;var e={items:m,start:_,end:D};for(var t in c)c[t].call(null,e)}var t=0;var n=5;var r=0;var i=500;var s=true;var o=false;var u=[];var a=[];var f=[];var l=[];var c=[];var h={preInit:u,postInit:a,disable:f,changeSize:l,changePos:c};var p=false;var d=0;var v=0;var m=0;var g=0;var y=0;var b=[];var w=[];var E=[];var S=[];var x=[];var T=0;var N=0;var C=0;var k=0;var L=0;var A=0;var O=0;var M=0;var _=0;var D=0;var P=0;e.scrollless={on:function(e,t){if(e in h)j(h[e],t);return this},setPos:function(e){if(typeof e=="object")U(e.pos,e.left,e.right);else if(typeof e=="number")U(e)},disable:function(){X(false)}};e.fn.scrollless=function(n){if(!((!n||typeof n=="object")&&this&&this.length))return this;if(!d){d=this.eq(0);e(window).on("resize",function(){I()})}if(H(n))U(t);else X(false);return this};var J=0;var K=0;var rt=0;var it=0})(jQuery)